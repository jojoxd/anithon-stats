include:
  - project: tools/reviewdog
    ref: main
    file: /templates/eslint.yml

cache: &global-cache
  key:
    files:
      - yarn.lock

  paths:
    - .yarn/cache

stages:
  - build
  - review

build:
  stage: build

  script:
    - yarn install

  cache:
    <<: *global-cache
    policy: pull-push

reviewdog:eslint:
  stage: review

  cache:
    <<: *global-cache
    policy: pull

  before_script:
    - apk add --update --no-cache
        python3 make g++ libc6-compat
        fontconfig freetype-dev
        imagemagick
        cairo cairo-dev
        libjpeg jpeg-dev libjpeg-turbo-dev
        pango pango-dev
        giflib giflib-dev
        pixman pixman-dev pangomm-dev
    - yarn install

  variables:
    COMMAND: 'yarn lint'
    RD_FORMAT: 'eslint'
